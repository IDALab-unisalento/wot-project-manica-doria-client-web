<div class="padding-md">
  <div class="card shadow dimension">

    <div class="card-header">
      <h3>Maintenance</h3>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-6">

          <div class="input-group">
            <select class="custom-select border-right-0" style="border-radius: 10px 0 0 10px;"
              id="inputGroupSelectMaintenance" (change)="getAllStepByMaintenance(); getAllZoneByMachine()">
              <option value="0" selected>Choose a Maintenance...</option>
              <option *ngFor="let maintenance of maintenanceList" value="{{maintenance.id}}">{{maintenance.name}}
                ({{maintenance.type}})</option>
            </select>

            <a class="btn border-top border-bottom" style="border-radius: 0; border: #cfd4d9"
              (click)="formMaintenance()">
              <i class="fa fa-plus-square-o fa-lg"></i>
            </a>
            <a class="btn border border-left-0" style="border-radius: 0 10px 10px 0; border: #cfd4d9"
              (click)="deleteMaintenance()">
              <i class="fa fa-trash fa-lg text-danger"></i>
            </a>
          </div>

          <form class="padding-top-sm" *ngIf="isCreate">
            <div class="form-group">
              <input placeholder="Maintenance name" type="text" class="form-control" #name name="name">
            </div>

            <select place class="custom-select" id="inputGroupSelect04">
              <option value="0" selected>Choose a Type..</option>
              <option value="Ordinary">Ordinary</option>
              <option value="Extraordinary">Extraordinary</option>
            </select>

            <div class="form-group pdt10">
              <textarea placeholder="Description" class="form-control" id="textAreaDescriptionMaintenance"
                rows="3"></textarea>
            </div>


            <div class="input-group">
              <select class="custom-select" id="inputGroupSelect01">
                <option value="0" selected>Choose a Machine...</option>
                <option *ngFor="let machine of machineList" value="{{machine.id}}">{{machine.name}}
                  ({{machine.serialNumber}})
                </option>
              </select>
            </div>

            <div class="d-flex justify-content-end padding-bottom-sm pdt10">
              <button type="submit" class="btn btn-success" (click)="saveMaintenance()">Save</button>
              <button type="submit" class="btn btn-danger" style=" margin-left: 10px;"
                (click)="annulla()">Cancel</button>
            </div>

          </form>

          <div *ngIf="!isCreate">

            <div class="input-group pdt10">
              <select class="custom-select" id="inputGroupSelect02" style="border-radius: 10px;">
                <option value="0" selected>Choose a Zone...</option>
                <option *ngFor="let zone of zoneList" value="{{zone.id}}">{{zone.name}} ({{zone.beacon.name}})
                </option>
              </select>
            </div>
            <small class="pdb10" style="color: #a0a0a0;">Select a maintenance area</small>

            <div class="form-group pdx10">
              <input placeholder="Name Step" type="text" class="form-control" #name name="name">
            </div>

            <div class="form-group">
              <span style="margin-right: 10px">Estimated duration</span>
              <input placeholder="Estimated Duration" style="border: 1px solid #aeaeae; border-radius: 10px" type="time"
                id="appt" name="appt" min="09:00" max="18:00" required (change)="print()">
            </div>

            <div class="form-group">
              <textarea style="border-radius: 10px;" placeholder="Description" class="form-control border-radius"
                id="textAreaDescriptionStep" rows="3"></textarea>
            </div>

            <form>

              <div class="input-group">
                <div class="custom-file">
                  <input (change)="onFileSelected($event)" type="file" class="custom-file-input" id="inputImage"
                    accept="image/*" multiple="multiple">
                  <label class="custom-file-label" for="inputImage" aria-describedby="inputImage"
                    style="overflow: scroll;">{{fileName}}</label>
                </div>
              </div>


              <div class="form-group pdt10">
                <input placeholder="Add Video Url" style="border-radius: 10px;" type="text" class="form-control"
                  [(ngModel)]="video" name="video">
              </div>

            </form>
            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-outline-secondary" (click)="getZoneById()">Aggiungi
                Step</button>
            </div>

          </div>
        </div>

        <div *ngIf="!isCreate">
          <div class="col d-flex justify-content-center">
            <div *ngIf=" stepList.length !==0;">
              <ul class=" list-group" *ngFor="let step of stepList, let myindex = index">
                <li class="list-group-item border-0">
                  <div class="row">
                    <div class="col-10 border-color">
                      <a class="btn bg-transparent" data-toggle="collapse" href="#collapseExample{{myindex}}"
                        role="button" aria-expanded="false" aria-controls="collapseExample">
                        {{myindex + 1}}. {{step.name}} (Step: {{step.zone.name}})
                      </a>
                      <div class="collapse" id="collapseExample{{myindex}}">
                        <div class="card card-body">
                          Descrizione: {{step.description}}
                          <div id="carouselExampleControls{{myindex}}" class="carousel slide" data-ride="carousel"
                            style="height: 500px; width: 300px">
                            <div class="carousel-inner">
                              <div class="carousel-item"
                                *ngFor="let attachment of step.attachmentList, let isFirst = first"
                                [ngClass]="{active:isFirst}">
                                <img *ngIf="attachment.type == 'image'" [src]="attachment.encodedFile"
                                  style="height: 300px; width: 300px">
                                <iframe id="myIframe" src="" *ngIf="attachment.type == 'video'" width="300" height="300"
                                  (focus)="iframeDidLoad(attachment.path)">
                                </iframe>
                              </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleControls{{myindex}}" role="button"
                              data-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleControls{{myindex}}" role="button"
                              data-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="sr-only">Next</span>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-2 d-flex justify-content-end">
                      <a class="btn bg-transparent fa-lg " style="color: #960000; "
                        (click)="deleteStep(step.id, myindex)">
                        <i class="fa fa-trash fa-lg" aria-hidden="true"></i>
                      </a>
                    </div>
                  </div>
                </li>
              </ul>
              <button type="submit" class="btn btn-outline-secondary" (click)="saveStep()">Salva e Completa</button>
            </div>
          </div>
        </div>
      </div>